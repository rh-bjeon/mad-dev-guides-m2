= 1. 소개 - 10분
:imagesdir: ../assets/images

[NOTE]
====
이전 모듈에서 소개 연습을 이미 완료했다면, '리팩토링' 랩으로 건너뛰어도 됩니다. 이 연습은 환경을 소개하고 서비스가 올바르게 실행되고 있는지 확인하기 위한 것입니다.
====

워크로드를 클라우드로 마이그레이션하거나 현대화하는 것에 대해 말하는 일반적인 방식은 *6R 프레임워크* 로 명명되었습니다. 이 프레임워크는 다음과 같이 세분화할 수 있습니다.

image::mod-strategies-refactor.png[Modernization Strategies]

리팩토링(재작성 또는 재아키텍처 포함)의 경우, Red Hat은 다음과 같은 접근 방식을 통해 고객의 애플리케이션 현대화 여정을 지원합니다.

* 개별적으로 관찰 가능한 마이크로서비스로 서비스를 반복적으로 전환하여 각각의 컨테이너에서 실행
* 빠른 내부 개발 루프를 통한 개발자 생산성 향상. link:https://www.redhat.com/en/products/runtimes[클라우드 네이티브 런타임^] (예: link:https://www.redhat.com/en/topics/cloud-native-apps/what-is-quarkus[Quarkus^], link:https://access.redhat.com/products/spring-boot[Spring Boot^])을 사용하여 더 빠른 시작 시간 확보 (예: Quarkus, Spring Boot)
* 격리된 도메인을 통해 더 빠른 반복 작업, 서비스 복구, 효율적인 확장성, 그리고 빠른 실험 가능
* 더 높은 혁신성과 확장성을 보다 낮은 비용으로 달성하기 위해 애플리케이션 서비스와 통합할 수 있는 기초 마련

이 모듈은 다음과 같이 2가지 단계(_리팩토링_, _배포_)를 안내합니다.

* 레거시 애플리케이션(*Customers*)을 리팩토링하여 https://docs.redhat.com/en/documentation/migration_toolkit_for_applications/7.0/html-single/introduction_to_the_migration_toolkit_for_applications/index[Migration Toolkit for Applications (MTA)^] 분석 보고서에 있는 레거시 구성 문제를 해결합니다.
* link:https://docs.redhat.com/en/documentation/openshift_container_platform/4.15/html/builds_using_buildconfig/creating-build-inputs#builds-binary-source_creating-build-inputs[OpenShift 바이너리 빌드 및 배포^]를 사용하여 현대화된 애플리케이션을 OpenShift에 배포합니다.

== 1.1. Globex 리테일 시스템 아키텍처 이해

Globex는 이 워크숍에서 사용할 가상의 회사입니다. 워크숍 환경의 Globex 시스템은 아래에 설명된 대로 가상머신과 컨테이너 플랫폼 등 여러 플랫폼에 배포된 마이크로서비스 애플리케이션으로 구성되어 있습니다.

image::architecture_initial_m2.png[architecture_initial_m2]

이 워크숍의 초기 상태는 레거시 가상화 및 Red Hat OpenShift 컨테이너 플랫폼에 걸쳐 있는 환경입니다.

애플리케이션은 레거시 환경에서 일부가 이미 OpenShift로 이전된 상태입니다.

Globex 리테일 애플리케이션은 _Node.js_ 프론트엔드 서비스로 구성되어 있으며, 데이터는 게이트웨이 서비스를 통해 가져옵니다. 게이트웨이 서비스는 세 개의 백엔드 서비스(customers, orders, inventory)와 연결되어 있으며, 각 서비스는 자체 데이터베이스를 사용해 데이터를 저장합니다.

OpenShift에서 실행 중인 서비스는 `retail-%USERID%` 네임스페이스에 배포됩니다. 이후 모듈에서 *OpenShift GitOps* 와 *Pipelines* 를 사용하여 이러한 서비스를 관리하게 됩니다.

[IMPORTANT]
====
**customers 파드가 _ImagePullBackOff Error_ 로 인해 실패한 상태일 수 있습니다. 나중에 OpenShift CI/CD 및 GitOps 섹션을 완료하면 자동으로 수정됩니다.**
====

애플리케이션의 모든 소스 코드와 모든 서비스의 GitOps YAML 매니페스트는 워크숍 목적으로 OpenShift 클러스터에 호스팅된 (Git 호환) *Gitea* 저장소에 저장됩니다.

현재 애플리케이션의 문제는 *customers* 서비스에 있습니다.

* customers 서비스는 Legacy Virtualization의 VM에서 Apache Tomcat에서 실행되는 오래된 Java 코드 기반을 사용합니다. 이 모듈에서는 이 레거시 Java 애플리케이션을 평가하고 분석하여 Java 코드를 현대화하고 Red Hat JBoss Web Server 위에 있는 OpenShift에 애플리케이션을 배포하는 가장 좋은 방법을 알아봅니다.
* customers 데이터베이스는 Legacy Virtualization에서 VM으로 실행되는 PostgreSQL 데이터베이스를 사용합니다. Globex의 IT 운영 팀은 고객 데이터베이스를 OpenShift 컨테이너화로 마이그레이션하여 현대화하려고 합니다.

이 워크숍의 모든 모듈을 완료했을 때 보이는 배포 아키텍처는 다음과 같습니다.

image::architecture_completed.png[architecture_completed]

== 1.2. 워크숍 환경

=== 1.2.1. 유저 이름을 확인하세요!

화면 상단의 상자를 살펴보세요. 유저 이름이 이미 설정되어 있나요? 그렇다면 다음과 같이 표시됩니다.

image::alreadyset.png[alreadyset]

`username` 이 제대로 설정되었다면 다음으로 넘어갈 수 있습니다. *그렇지 않다면 할당된 유저 ID를 위의 상자에 다음과 같이 입력하세요.*

image::setuser.png[setuser]

이렇게 하면 이 워크숍의 링크와 복사/붙여넣기 코드가 커스터마이징됩니다. 실수로 잘못된 유저 이름을 입력한 경우 URL 매개변수에서 유저 이름을 업데이트하기만 하면 됩니다(예: `1-introduction.html?USERID=%USERID%` )

[IMPORTANT]
====
핸즈온 랩을 실행하는 동안 *고유한 사용자 이름*(예: `%USERID%`)을 사용해야 합니다. 예를 들어, 자신의 프로젝트에 애플리케이션을 배포해야 합니다(예: retail-%USERID%).
====

=== 1.2.2. 오픈시프트 클러스터

귀하의 OpenShift 클러스터는 이미 필요한 모든 것이 구성되어 있습니다. 자세한 내용은 다음과 같습니다.

* 소스 코드 저장소를 호스팅하는 `Gitea`
* GitOps 접근 방식을 사용하여, ArgoCD를 통해 배포된 서비스를 관리하기 위한 `OpenShift GitOps`
* GitOps를 사용하여 소스 코드에서 고객 애플리케이션을 빌드하고 `retail` 프로젝트에 배포하기 위한 `OpenShift Pipelines`
* customer 서비스 현대화에 도움이 되는 `Migration Toolkit for Applications`

=== 1.2.3. Visual Studio Code 서버

VSCode는 이미 OpenShift 클러스터에 배포되어 IDE로 사용할 수 있습니다. 즉, 시스템에 아무것도 설치하고 구성할 필요가 없습니다. 이렇게 하면 복제된 리포지토리에서 소스 코드와 구성 파일을 쉽게 변경할 수 있습니다.

시작하려면 링크: https://codeserver-codeserver-%USERID%.%SUBDOMAIN%[VS Code 서버 인스턴스^]에 액세스하고 다음 `비밀번호` 를 사용하여 로그인하세요.

* 비밀번호: `{openshift-password}`

image::vscode-server-login.png[vscode-server-login]

그래픽 사용자 인터페이스(GUI)는 다음과 같습니다.

image::vscode.png[VSCode]

== 1.3. OpenShift에 로그인

Frontend 웹 애플리케이션에 액세스하여 리테일 서비스 애플리케이션에 액세스할 수 있는지 확인하세요. *Frontend* 애플리케이션에 액세스할 URL을 찾으려면 OpenShift 명령줄 도구(`oc`)를 사용해야 합니다. 

VS Code 서버로 이동하여, _oc_ 명령어가 사전에 설치되어 있는 새 터미널을 엽니다.

VS Code의 Terminal 메뉴에서 `New Terminal` 을 클릭합니다. 새 터미널이 열리면 다음과 같이 _oc_ 명령어를 실행합니다.

[.console-input]
[source,bash]
----
oc login -u %USERID% -p openshift https://openshift.default.svc:443
----

image::vscode-terminal.png[vscode-terminal]

[NOTE]
====
복사/붙여넣기 허용에 대한 팝업 메시지가 나타나면, *"클립보드에 복사된 텍스트와 이미지를 확인하세요"*, `허용` 을 클릭합니다. 그러면 터미널에서 `"안전하지 않은 연결을 사용하시겠습니까?"` 라는 메시지가 표시될 수도 있습니다. 그럴 경우 `y` 를 누릅니다.
====

== 1.4 작업할 브랜치 변경

오늘 이 모듈에서 사용할 올바른 브랜치인 `ocp-4.15` 로 *check out* 하세요!

VS Code 터미널에서 다음 `git` 명령을 실행합니다.

[.console-input]
[source,bash]
----
git checkout ocp-4.15
----

출력은 다음과 같아야 합니다.

[.console-output]
[source,bash,subs="+attributes,macros+"]
----
branch 'ocp-4.15' set up to track 'origin/ocp-4.15'.
Switched to a new branch 'ocp-4.15'
----

== 축하합니다!

이제 애플리케이션 아키텍처에 대해 성공적으로 알아보고 워크숍 환경을 확인했습니다.

다음 단계에서는 애플리케이션 소스 코드를 분석하고 리팩토링하여 OpenShift에서 Linux 컨테이너로 실행되도록 현대화 과정을 계속합니다.